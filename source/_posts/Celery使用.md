---
title: Celery使用
date: 2022-01-13 11:31:07
tags: Python
top: 0
---


# 一、celery异步

celery是异步任务的调度工具，主要解决耗时任务，通过**消息队列**在客户端与消费者间协调

- 消息中间件（消息队列Broker）：客户端把任务放入队列中，消费者从队列中取出任务执行，第三方队列服务：RabbitMQ\redis\kafka\MetaMQ\RocketMQ
  
  <!--more-->
  
  - **RabbitMQ：**是一个消息代理。工作是接收和转发消息类似邮局，处理消息
    - 异步消息：支持多种传递协议，消息排队，传递确认，到队列的灵活路由，多种交换类型
    - 分布式部署：部署为集群以实现高可用和吞吐量
    - 可靠性：可在性能和可靠性之间进行权衡
    - 灵活的路由：通过交换机进行路由
    - 多协议：多种消息协议的消息传递
    - 管理与监控：HTTP-API，命令行工具
  - **基本慨念：**
    - Producer：生产者，投递消息的程序：创建消息（消息体和标签），RabbitMQ会根据标签把消息发送给消费者
    - Consumer：消费者，接收消息的程序：丢弃标签，消费消息体
    - Broker：消息中间件的服务节点：RabbitMQ服务实例
    - Queue：队列：内部对象，用于存储信息，生产者投递，消费者取出消费
    - Xchange：交换器。指定消息按什么规则，路由到哪个队列，如果路由不到或返回或丢弃
    - RoutingKey：路由键关键字，Xchange根据此来进行邮递，需要与交换器类型和绑定键联合使用，决定消息流向哪里
    - Binding：绑定，把Xchange和Queue按照路由规则绑定起来，指定绑定键（BindingKey）
  
- 任务执行单元（消费者worker）：可以有多个并发，实时监控消息队列，获取任务并执行它

- 任务执行结果存储（task result store）：由于是由主任务中解耦出来的，主任务想要知道执行结果，必须通过中间件存储
